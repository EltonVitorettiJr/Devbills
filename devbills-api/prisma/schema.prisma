generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Category {
  id        String          @id @default(auto()) @map("_id") @db.ObjectId // Id da categoria
  name      String          // Nome da categoria
  color     String          // Cor da categoria (hex ou nome)
  type      TransactionType // Tipo da transação: expense ou income 
  createdAt DateTime        @default(now()) // Data de criação do registro
  updatedAt DateTime        @updatedAt      // Data da última atualização

  transactions Transaction[] // Transações relacionadas a essa categoria (relação 1:N)

  @@unique([name, type]) // Evitar conflitos de duas categorias com mesmo nome e tipo
}

enum TransactionType {
  expense // Despesa
  income  // Receita
}

model Transaction {
  id          String          @id @default(auto()) @map("_id") @db.ObjectId // Id da transação
  description String          // Descrição da transação
  amount      Float           // Quantidade da transação
  date        DateTime        // Data de Realização da transação
  type        TransactionType // Tipo da transação: expense ou income
  userId      String          // Id do usuário dono da transação
  createdAt   DateTime        @default(now()) // Marca a data de criação da transação
  updatedAt   DateTime        @updatedAt      // Marca a data de alteração da transação

  categoryId String   @db.ObjectId // Chave estrangeira (Foreign Key) da categoria
  category   Category @relation(fields: [categoryId], references: [id]) // Objeto da relação para o Prisma

  @@index([userId, date]) // Índice para otimizar consultas por usuário e data
  @@index([userId, date, categoryId]) // Índice composto para filtros mais específicos
}